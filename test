import requests
import base64
import os
from read_api_key_file import read_api_keys

API_KEY, API_SECRET = read_api_keys("api-key-test.txt")

auth = base64.b64encode(f"{API_KEY}:{API_SECRET}".encode()).decode()

headers = {
    "Authorization": f"Basic {auth}",
    "Content-type": "application/json"
}

url = "https://api.confluent.cloud/iam/v2/service-accounts"
payload = {
    "display_name": "test-sa",
    "description": "Test SA"
}

try:
    response = requests.post(url, json=payload, headers=headers)
    response.raise_for_status()

    sa = response.json()
    print(f"Service Account créé: {sa['display_name']} (ID: {sa['id']}")
except requests.exceptions.RequestException as e:
    print(f"Erreur: {e}")
